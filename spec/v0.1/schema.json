{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://firl.nl/twff/spec/v0.1/schema.json",
  "title": "TWFF v0.1 Schema",
  "description": "Version-pinned schema for TWFF v0.1. Includes process-log and event definitions.",
  "version": "0.1.0",
  "definitions": {
    "process_log": {
      "type": "object",
      "required": ["version", "session_id", "user_id", "start_time", "end_time", "content_source", "events"],
      "properties": {
        "version":        { "type": "string", "const": "0.1.0" },
        "session_id":     { "type": "string", "format": "uuid" },
        "user_id":        { "type": "string", "minLength": 1, "maxLength": 128 },
        "start_time":     { "type": "string", "format": "date-time" },
        "end_time":       { "type": "string", "format": "date-time" },
        "content_source": { "type": "string" },
        "events":         { "type": "array", "items": { "$ref": "#/definitions/event" } },
        "_integrity":     { "$ref": "#/definitions/integrity" }
      }
    },
    "event": {
      "type": "object",
      "required": ["timestamp", "type", "meta"],
      "properties": {
        "timestamp": { "type": "string", "format": "date-time" },
        "type": {
          "type": "string",
          "enum": ["session_start","session_end","edit","paste","ai_interaction","chat_interaction","focus_change","checkpoint"]
        },
        "meta": { "type": "object" }
      }
    },
    "integrity": {
      "type": "object",
      "required": ["algorithm", "salt", "hash"],
      "properties": {
        "algorithm": { "type": "string", "enum": ["SHA-256"] },
        "salt":      { "type": "string" },
        "hash":      { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "note":      { "type": "string" }
      }
    }
  }
}
